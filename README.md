# BorderControl
# Система компьютерного зрения для БПЛА

Набор bash-скриптов для запуска системы детекции дороги/поля и трекинга БПЛА с использованием компьютерного зрения.

## Быстрый старт

### Предварительная настройка

```bash
# Предоставить права на выполнение скриптов
chmod +x run_segcv.sh run_segsift.sh run_segcvsift.sh

# Создать директории для логов
mkdir -p segmentation/segmentation segmentation/tracking_logs

# Подготовить панорамное изображение (обязательно для трекера)
cp /путь/к/вашей/панораме.jpg panorama_output.jpg
```

## Описание и использование скриптов

### run_segcv.sh - Детектор дороги/поля

**Назначение:** Запуск модуля детекции дорожной поверхности с камеры в реальном времени.

**Особенности:**
- Автоматическая проверка наличия необходимых файлов
- Проверка доступности камеры `/dev/video0`
- Минималистичный интерфейс
- Обработка ошибок выполнения

**Запуск:**
```bash
./run_segcv.sh
```

**Логика работы:**
1. Проверяет существование файла `segmentation/scv_cam.py`
2. Проверяет доступность камеры через `/dev/video0`
3. Запускает Python-скрипт с помощью `python3.8`
4. Обрабатывает код возврата и выводит соответствующее сообщение

---

### run_segsift.sh - Трекер БПЛА

**Назначение:** Запуск модуля трекинга БПЛА с использованием камеры и предварительно подготовленного панорамного изображения.

**Конфигурируемые параметры (внутри скрипта):**
```bash
PANORAMA_IMAGE="panorama_output.jpg"  # Путь к файлу панорамы
FRAME_INTERVAL=10                     # Интервал обработки кадров
PYTHON_SCRIPT="segmentation/ssift_cam.py" # Основной скрипт
LOG_DIR="segmentation/tracking_logs"  # Директория для логов
```

**Запуск:**
```bash
./run_segsift.sh
```

**Последовательность выполнения:**
1. Проверка наличия основного Python-скрипта
2. Проверка существования файла панорамы
3. Проверка доступности камеры через `/dev/video0` и V4L2
4. Дополнительная проверка: убеждается, что скрипт настроен на работу с камерой
5. Запуск основного скрипта с параметрами
6. Детальная обработка ошибок выполнения

---

### run_segcvsift.sh - Параллельный запуск

**Назначение:** Одновременный запуск обоих модулей (детектора и трекера) с расширенным логированием и мониторингом.

**Конфигурационные параметры:**
```bash
SCV_SCRIPT="segmentation/scv_cam.py"     # Скрипт детектора
SSIFT_SCRIPT="segmentation/ssift_cam.py" # Скрипт трекера
PANORAMA_IMAGE="output_panorama.jpg"     # Путь к панораме
LOG_DIR="segmentation/segmentation"      # Логи детектора
TRACKING_LOG_DIR="segmentation/tracking_logs" # Логи трекера
```

**Запуск:**
```bash
./run_segcvsift.sh
```

**Ключевые особенности:**
- **Параллельное выполнение:** Оба скрипта запускаются одновременно в фоновом режиме
- **Автологирование:** Автоматическое создание лог-файлов с timestamp
- **Мониторинг процессов:** Отслеживание состояния всех подпроцессов
- **Централизованная обработка ошибок:** Единая система обработки сбоев
- **Подробный вывод:** Tee-логирование в консоль и файлы одновременно

**Формат лог-файлов:**
- `segmentation/segmentation/scv_YYYYMMDD_HHMMSS.log`
- `segmentation/tracking_logs/ssift_YYYYMMDD_HHMMSS.log`

---

## Требования и зависимости

### Аппаратные требования
- Камера, доступная через `/dev/video0`
- Достаточная вычислительная мощность для обработки видео в реальном времени

### Программные требования
- **Python 3.8** (основная версия, указанная в скриптах)
- Библиотеки компьютерного зрения (OpenCV и др.)
- **Bash** окружение (Linux/macOS/WSL)
- Доступ к V4L2 для работы с камерой

### Файловые требования
```
segmentation/
├── scv_cam.py          # Скрипт детектора дороги/поля
├── ssift_cam.py        # Скрипт трекера БПЛА
├── segmentation/       # Директория для логов детектора
└── tracking_logs/      # Директория для логов трекера
```

---

## Решение проблем

### Камера не обнаружена
```bash
# Проверить доступные устройства
v4l2-ctl --list-devices

# Проверить права доступа
ls -la /dev/video*

# При необходимости изменить скрипт для использования другого устройства
```

### Файл панорамы отсутствует
```bash
# Создать или указать правильный путь к панораме
# Изменить переменную PANORAMA_IMAGE в скрипте
cp /правильный/путь/панорамы.jpg panorama_output.jpg
```

### Отсутствуют права на выполнение
```bash
# Предоставить права на выполнение
chmod +x run_*.sh

# Альтернативный запуск
bash run_segcv.sh
```

### Ошибка версии Python
```bash
# Проверить установленную версию
python3 --version

# При необходимости обновить скрипты, заменив python3.8 на python3
```

### Скрипты не найдены
```bash
# Проверить структуру проекта
ls -la segmentation/

# Убедиться, что файлы находятся в правильной директории
```

---

## Мониторинг и отладка

### Просмотр логов в реальном времени
```bash
# Логи детектора
tail -f segmentation/segmentation/scv_*.log

# Логи трекера  
tail -f segmentation/tracking_logs/ssift_*.log
```

### Проверка работы процессов
```bash
# Просмотр запущенных процессов
ps aux | grep python

# Проверка использования камеры
fuser /dev/video0
```

---

##  Рекомендации по использованию

1. **Перед первым запуском:** Убедитесь, что все зависимости Python установлены
2. **Для тестирования:** Запускайте модули по отдельности перед использованием параллельного режима
3. **Мониторинг:** Используйте логи для диагностики проблем
4. **Резервное копирование:** Сохраняйте рабочие версии панорамных изображений

---

**Примечание:** Все скрипты включают обработку ошибок и предоставляют подробные сообщения о статусе выполнения для удобства отладки.